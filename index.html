<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Répertoire Plaques</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; }
    .container { max-width: 400px; margin: auto; }
    .item { padding: 10px; border: 1px solid #ccc; margin-top: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Ajouter une plaque</h2>

    <label>Type de plaque</label>
    <select id="type">
      <option value="Classique">Classique</option>
      <option value="Diplomatique">Diplomatique</option>
      <option value="WW provisoire">WW provisoire</option>
      <option value="Collection">Collection</option>
      <option value="Police / Gendarmerie">Police / Gendarmerie</option>
    </select>

    <label>Département (plaque actuelle)</label>
    <select id="departement" style="display:none">
      <option value="">-- Sélectionner --</option>
      <option value="01">01 - Ain</option>
      <option value="02">02 - Aisne</option>
      <option value="03">03 - Allier</option>
      <option value="04">04 - Alpes-de-Haute-Provence</option>
      <option value="05">05 - Hautes-Alpes</option>
      <option value="06">06 - Alpes-Maritimes</option>
      <option value="07">07 - Ardèche</option>
      <option value="08">08 - Ardennes</option>
      <option value="09">09 - Ariège</option>
      <option value="10">10 - Aube</option>
      <option value="11">11 - Aude</option>
      <option value="12">12 - Aveyron</option>
      <option value="13">13 - Bouches-du-Rhône</option>
      <option value="14">14 - Calvados</option>
      <option value="15">15 - Cantal</option>
      <option value="16">16 - Charente</option>
      <option value="17">17 - Charente-Maritime</option>
      <option value="18">18 - Cher</option>
      <option value="19">19 - Corrèze</option>
      <option value="21">21 - Côte-d'Or</option>
      <option value="22">22 - Côtes-d'Armor</option>
      <option value="23">23 - Creuse</option>
      <option value="24">24 - Dordogne</option>
    </select>

    <label>Couleur</label>
    <input type="text" id="couleur" />

    <label>Date</label></label>
    <input type="date" id="date" />

    <label>Plaque</label>
    <input type="text" id="plaque" />

    <label>Propriétaire</label>
    <input type="text" id="proprio" />

    <label>Véhicule</label>
    <input type="text" id="vehicule" />

    <button id="saveBtn">Enregistrer</button>

    <h2>Liste des plaques</h2>
    <div id="list"></div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAFXsHbbtdQjT3xebw9cehUytV46S9qO1g",
    authDomain: "repertoireplaques.firebaseapp.com",
    projectId: "repertoireplaques",
    storageBucket: "repertoireplaques.firebasestorage.app",
    messagingSenderId: "1007663760164",
    appId: "1:1007663760164:web:327a6baf74020612c469b1",
    measurementId: "G-TC8MRJLGE3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Affichage auto du sélecteur département
  const typeSelect = document.getElementById("type");
  const departSelect = document.getElementById("departement");

  typeSelect.addEventListener("change", () => {
    if (typeSelect.value === "Classique") departSelect.style.display = "block";
    else departSelect.style.display = "none";
  });

  const saveBtn = document.getElementById("saveBtn");
  const list = document.getElementById("list");

  async function savePlaque() {
    const couleur = document.getElementById("couleur").value;
    const date = document.getElementById("date").value;
    const plaque = document.getElementById("plaque").value;
    const proprio = document.getElementById("proprio").value;
    const vehicule = document.getElementById("vehicule").value;

    if (!plaque) {
      alert("La plaque est obligatoire");
      return;
    }

    try {
      const type = document.getElementById("type").value;
      const departement = document.getElementById("departement").value;
      await addDoc(collection(db, "plaques"), {
        couleur,
        date,
        plaque,
        proprio,
        vehicule,
        type,
        departement
        type: document.getElementById("type").value
      });
      alert("Plaque enregistrée !");
      loadPlaques();
    } catch (e) {
      alert("Erreur : " + e.message);
    }
  }

  async function loadPlaques() {
    list.innerHTML = "Chargement...";
    const querySnapshot = await getDocs(collection(db, "plaques"));
    list.innerHTML = "";

    querySnapshot.forEach((doc) => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <b>Type :</b> ${data.type}<br>
        <b>Plaque :</b> ${data.plaque}<br>
        <b>Proprio :</b> ${data.proprio}<br>
        <b>Véhicule :</b> ${data.vehicule}<br>
        <b>Couleur :</b> ${data.couleur}<br>
        <b>Département :</b> ${data.departement || "N/A"}<br>
        <b>Date :</b> ${data.date}
      `;
      list.appendChild(div);
    });
  }

  saveBtn.onclick = savePlaque;
  loadPlaques();
</script>

</body>
</html>
